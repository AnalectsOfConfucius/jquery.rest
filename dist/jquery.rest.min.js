// jQuery REST Client - v0.0.6 - https://github.com/jpillora/jquery.rest
// Jaime Pillora <dev@jpillora.com> -  Copyright 2013
!function(a,b,c){"use strict";var d,e,f,g,h,i,j,k,l,m,n,o;j=function(a){throw"ERROR: jquery.rest: "+a},l=function(a){var b;for(b="";a-->0;)b+="  ";return b},i=function(b){return a.btoa||j("You need a polyfill for 'btoa' to use basic auth."),a.btoa(b)},m=function(b){return a.JSON||j("You need a polyfill for 'JSON' to use stringify."),a.JSON.stringify(b)},k=function(a,b){var c;return c=function(){},c.prototype=a,$.extend(!0,new c,b)},n=function(a){return a&&$.isPlainObject(a)?($.each(a,function(a){return g[a]===c?j("Unknown option: '"+a+"'"):void 0}),null):!1},o=function(a,b){return"string"!==$.type(b)?j("'"+a+"' must be a string"):void 0},h=function(){return alert('"delete()" has been deprecated. Please use "destroy()" or "del()" instead.')},g={url:"",cache:0,cachableMethods:["GET"],methodOverride:!1,stringifyData:!1,stripTrailingSlash:!1,password:null,username:null,verbs:{create:"POST",read:"GET",update:"PUT",destroy:"DELETE"},ajax:{dataType:"json"}},d=function(){function a(a){this.parent=a,this.c={}}return a.prototype.valid=function(a){var b;return b=(new Date).getTime()-a.getTime(),b<=1e3*this.parent.opts.cache},a.prototype.key=function(a){var b,c=this;return b="",$.each(a,function(a,d){return b+=a+"="+($.isPlainObject(d)?"{"+c.key(d)+"}":d)+"|"}),b},a.prototype.get=function(a){var b;return(b=this.c[a])?this.valid(b.created)?b.data:void 0:void 0},a.prototype.put=function(a,b){return this.c[a]={created:new Date,data:b}},a.prototype.clear=function(a){var b=this;return a?$.each(this.c,function(c){return c.match(a)?delete b.c[c]:void 0}):this.c={}},a}(),f=function(){function a(a,b,c,d){this.name=a,this.method=b,null==c&&(c={}),this.parent=d,o("name",this.name),o("method",this.method),n(c),this.parent[this.name]&&j("Cannot add Verb: '"+a+"' already exists"),this.method=b.toUpperCase(),c.url||(c.url=""),this.opts=k(this.parent.opts,c),this.root=this.parent.root,this.custom=!g.verbs[this.name],this.call=$.proxy(this.call,this),this.call.instance=this}return a.prototype.call=function(){var a;return a=this.parent.extractUrlData(this.method,arguments),this.custom&&(a.url+=this.opts.url||this.name),this.parent.ajax.call(this,this.method,a.url,a.data)},a.prototype.show=function(a){return console.log(l(a)+this.name+": "+this.method)},a}(),e=function(){function a(b,c,d){null==c&&(c={}),n(c),d&&d instanceof a?(this.name=b,o("name",this.name),this.constructChild(d,c)):(this.url=b||"",o("url",this.url),this.constructRoot(c))}return a.prototype.constructRoot=function(a){return this.opts=k(g,a),this.root=this,this.numParents=0,this.urlNoId=this.url,this.cache=new d(this),this.parent=null,this.name=this.opts.name||"ROOT"},a.prototype.constructChild=function(b,c){return this.parent=b,o("name",this.name),this.parent instanceof a||this.error("Invalid parent"),this.parent[this.name]&&this.error("'"+name+"' already exists"),c.url||(c.url=""),this.opts=k(this.parent.opts,c),this.root=this.parent.root,this.numParents=this.parent.numParents+1,this.urlNoId=this.parent.url+(""+(this.opts.url||this.name)+"/"),this.url=this.urlNoId+(":ID_"+this.numParents+"/"),$.each(this.opts.verbs,$.proxy(this.addVerb,this)),this.destroy?(this.del=this.destroy,this["delete"]=h):void 0},a.prototype.error=function(a){return j("Cannot add Resource: "+a)},a.prototype.add=function(b,c){return this[b]=new a(b,c,this)},a.prototype.addVerb=function(a,b,c){return this[a]=new f(a,b,c,this).call},a.prototype.show=function(b){return null==b&&(b=0),b>25&&j("Plugin Bug! Recursion Fail"),this.name&&console.log(l(b)+this.name+": "+this.url),$.each(this,function(a,c){return"function"===$.type(c)&&c.instance instanceof f&&"del"!==a?c.instance.show(b+1):void 0}),$.each(this,function(c,d){return"parent"!==c&&"root"!==c&&d instanceof a?d.show(b+1):void 0}),null},a.prototype.toString=function(){return this.name},a.prototype.extractUrlData=function(a,b){var c,d,e,f,g,h,i,k,l,m,n,o,p,q,r,s;for(i=[],f=null,m=null,p=0,r=b.length;r>p;p++)c=b[p],n=$.type(c),"string"===n||"number"===n?i.push(c):"object"===n&&null===f?f=c:j("Invalid argument: "+c+" ("+n+")."+" Must be strings or ints (IDs) followed by one optional object (data).");for(l=i.length,d="create"!==a,e="update"!==a&&"delete"!==a,o=null,d&&l===this.numParents&&(o=this.url),e&&l===this.numParents-1&&(o=this.urlNoId),null===o&&(e&&(k=this.numParents-1),d&&(k=(k?k+" or ":"")+this.numParents),j("Invalid number of ID arguments, required "+k+", provided "+l)),g=q=0,s=i.length;s>q;g=++q)h=i[g],o=o.replace(new RegExp("/:ID_"+(g+1)+"/"),"/"+h+"/");return{url:o,data:f}},a.prototype.ajax=function(a,b,c,d){var e,f,g,h,k,l=this;return null==d&&(d={}),a||j("method missing"),b||j("url missing"),this.opts.username&&this.opts.password&&(f=i(this.opts.username+":"+this.opts.password),d.Authorization="Basic "+f),c&&this.opts.stringifyData&&(c=m(c),d["Content-Type"]="application/json"),this.opts.methodOverride&&"GET"!==a&&"HEAD"!==a&&"POST"!==a&&(d["X-HTTP-Method-Override"]=a,a="POST"),this.opts.stripTrailingSlash&&(b=b.replace(/\/$/,"")),e={url:b,type:a,headers:d},c&&(e.data=c),e=$.extend(!0,{},this.opts.ajax,e),k=this.opts.cache&&$.inArray(a,this.opts.cachableMethods)>=0,k&&(g=this.root.cache.key(e),h=this.root.cache.get(g))?h:(h=$.ajax(e),k&&h.done(function(){return l.root.cache.put(g,h)}),h)},a}(),e.defaults=g,$.RestClient=e}(window,document);