/*! jQuery REST Client - v0.0.2 - 2013-01-19
* https://github.com/jpillora/jquery.rest
* Copyright (c) 2013 Jaime Pillora; Licensed MIT */
(function(){"use strict";var e,t,n,r,i,s,o,u,a,f;s=function(e){throw"ERROR: jquery.rest: "+e},u={create:"POST",read:"GET",update:"PUT","delete":"DELETE"},a=function(e){var t;t="",e*=2;while(e-->0)t+=" ";return t},i=function(e){return window.btoa||s("You need a polyfill for 'btoa' to use basic auth."),window.btoa(e)},f=function(e){return window.JSON||s("You need a polyfill for 'JSON' to use stringify."),window.JSON.stringify(e)},o=function(e,t){var n;return n=function(){},n.prototype=e,$.extend(new n,t)},r={url:"",cache:0,cacheTypes:["GET"],stringifyData:!1,dataType:"json",disablePut:!1,processData:!0,crossDomain:!1,timeout:null,username:null,password:null},e=function(){function e(e){this.parent=e,this.c={}}return e.prototype.valid=function(e){var t;return t=(new Date).getTime()-e.getTime(),t<=this.parent.opts.cache*1e3},e.prototype.key=function(e){return f(e)},e.prototype.get=function(e){var t;t=this.c[e];if(!t)return;if(this.valid(t.entry))return t.data},e.prototype.put=function(e,t){return this.c[e]={entry:new Date,data:t}},e.prototype.clear=function(e){var t=this;return e?$.each(this.c,function(n,r){if(n.match(e))return delete t.c[n]}):this.c={}},e}(),t=function(){function e(e){var t,n,r,i,a;return r=e.name,a=e.type,i=e.parent,r||s("name required"),a||s("type required"),i||s("parent required"),i[r]&&s("Cannot add Operation: '"+r+"' already exists"),t=!u[r],a=a.toUpperCase(),n=function(){var i;return i=this.extractUrlData(a,arguments),t&&(i.url+=e.url||r),this.ajax.call(n,a,i.url,i.data)},n.isOperation=!0,n.type=a,n.root=i.root,n.opts=o(i.opts,e),n}return e}(),n=function(){function n(e){e==null&&(e={}),e.parent?this.constructChild(e):this.constructRoot(e)}return n.prototype.add=function(e,r){return"string"===$.type(e)&&(e={name:e}),$.isPlainObject(e)||s("Invalid data. Must be an object or string."),r&&(e.type=r),e.parent=this,this[e.name]=e.type?new t(e):new n(e)},n.prototype.constructRoot=function(t){return t==null&&(t={}),"string"===$.type(t)&&(this.url=t,t={}),this.opts=o(r,t),this.url||(this.url=this.opts.url),this.urlNoId=this.url,this.cache=new e(this),this.numParents=0,this.root=this,this.name=t.name||"ROOT"},n.prototype.constructChild=function(e){return this.parent=e.parent,this.name=e.name,this.parent instanceof n||this.error("Invalid parent"),this.name||this.error("name required"),this.parent[this.name]&&this.error("'"+name+"' already exists"),this.root=this.parent.root,this.opts=o(this.parent.opts,e),this.numParents=this.parent.numParents+1,this.urlNoId=this.parent.url+(""+(e.url||this.name)+"/"),this.url=this.urlNoId+(":ID_"+this.numParents+"/"),$.each(u,$.proxy(this.add,this)),this.del=this["delete"]},n.prototype.error=function(e){return s("Cannot add Resource: "+e)},n.prototype.show=function(e){var t=this;return e==null&&(e=0),e>15&&s("Recurrsion Fail"),this.name&&console.log(a(e)+this.name+": "+this.url),$.each(this,function(t,n){if(n.isOperation===!0&&t!=="del")return console.log(a(e+1)+n.type+": "+t)}),$.each(this,function(t,r){if(t!=="parent"&&t!=="root"&&r instanceof n)return r.show(e+1)}),null},n.prototype.toString=function(){return this.name},n.prototype.extractUrlData=function(e,t){var n,r,i,o,u,a,f,l,c,h,p,d,v,m;f=[],o=null;for(p=0,v=t.length;p<v;p++)n=t[p],$.type(n)==="string"?f.push(n):$.isPlainObject(n)&&o===null?o=n:s("Invalid parameter: "+n+" ("+$.type(n)+")."+" Must be strings (IDs) and one optional plain object (data).");c=f.length,r=e!=="create",i=e!=="update"&&e!=="delete",h=null,r&&c===this.numParents&&(h=this.url),i&&c===this.numParents-1&&(h=this.urlNoId),h===null&&(i&&(l=this.numParents-1),r&&(l=(l?l+" or ":"")+this.numParents),s("Invalid number of ID parameters, required "+l+", provided "+c));for(u=d=0,m=f.length;d<m;u=++d)a=f[u],h=h.replace(new RegExp("/:ID_"+(u+1)+"/"),"/"+a+"/");return{url:h,data:o}},n.prototype.ajax=function(e,t,n,r){var o,u,a,l,c,h=this;r==null&&(r={}),e||s("type missing"),t||s("url missing"),this.opts.username&&this.opts.password&&(u=i(this.opts.username+":"+this.opts.password),r.Authorization="Basic "+u),n&&this.opts.stringifyData&&(n=f(n)),e==="PUT"&&this.opts.disablePut&&(e="POST"),o={url:t,type:e,headers:r,data:n,timeout:this.opts.timeout,crossDomain:this.opts.crossDomain,processData:this.opts.processData,dataType:this.opts.dataType},c=this.opts.cache&&this.opts.cacheTypes.indexOf(e)>=0;if(c){a=this.root.cache.key(o),l=this.root.cache.get(a);if(l)return l}return l=$.ajax(o),c&&l.complete(function(){return h.root.cache.put(a,l)}),l},n}(),$.RestClient=n}).call(this);