/*! jQuery REST Client - v0.0.2 - 2013-01-19
* https://github.com/jpillora/jquery.rest
* Copyright (c) 2013 Jaime Pillora; Licensed MIT */
(function(){"use strict";var e,t,n,r,i,s,o,u,a,f,l;s=function(e){throw"ERROR: jquery.rest: "+e},a={create:"POST",read:"GET",update:"PUT","delete":"DELETE"},f=function(e){var t;t="",e*=2;while(e-->0)t+=" ";return t},i=function(e){return window.btoa||s("You need a polyfill for 'btoa' to use basic auth."),window.btoa(e)},l=function(e){return window.JSON||s("You need a polyfill for 'JSON' to use stringify."),window.JSON.stringify(e)},u=function(e,t){var n;return n=function(){},n.prototype=e,$.extend(new n,t)},o=function(e){var t;return $.isPlainObject(e)?t=e.name||e.url:"string"===$.type(e)?(t=e,e=null):s("Invalid data. Must be an object or string."),{data:e,name:t}},r={url:"",cache:0,stringifyData:!1,dataType:"json",processData:!0,crossDomain:!1,timeout:null,username:null,password:null},e=function(){function e(e){this.parent=e,this.c={}}return e.prototype.valid=function(e){var t;return t=(new Date).getTime()-e.getTime(),t<=this.parent.opts.cache*1e3},e.prototype.key=function(e){return l(e)},e.prototype.get=function(e){var t;t=this.c[e];if(!t)return;if(this.valid(t.entry))return t.data},e.prototype.put=function(e,t){return this.c[e]={entry:new Date,data:t}},e.prototype.flush=function(e){return e?this.c[e]=null:this.c={}},e}(),t=function(){function e(e,t,n){var r,i;return e||s("name required"),t||s("type required"),n||s("parent required"),n[e]&&s("Cannot add Operation: '"+e+"' already exists"),i=!a[e],t=t.toUpperCase(),r=function(){var n,r,s;return s=this.extractUrlData(t,arguments),r=s.url,n=s.data,this.ajax(t,r+(i?e:""),n)},r.isOperation=!0,r.type=t,r}return e}(),n=function(){function n(e,t){t?this.constructChild(e,t):this.constructRoot(e)}return n.prototype.constructRoot=function(t){var n,i;return t==null&&(t=""),i=o(t),n=i.name,t=i.data,this.url=n,t=t||{},this.opts=u(r,t),this.url||(this.url=this.opts.url),this.urlNoId=this.url,this.cache=new e(this),this.numParents=0,this.root=this,this.name="ROOT"},n.prototype.constructChild=function(e,t){var r,i;return t instanceof n||s("Invalid parent"),i=o(e),r=i.name,e=i.data,r||s("name required"),e=e||{},t[r]&&s("Cannot add Resource: '"+r+"' already exists"),this.parent=t,this.root=t.root,this.opts=u(t.opts,e),this.name=r,this.numParents=t.numParents+1,this.urlNoId=t.url+(""+this.name+"/"),this.url=this.urlNoId+(":ID_"+this.numParents+"/"),$.each(a,$.proxy(this.add,this)),this.del=this["delete"]},n.prototype.add=function(e,r){var i,s;return s=o(e),i=s.name,e=s.data,r?this[i]=new t(i,r,this):this[i]=new n(e||i,this),null},n.prototype.show=function(e){var t=this;return e==null&&(e=0),e>15&&s("Recurrsion Fail"),this.name&&console.log(f(e)+this.name+": "+this.url),$.each(this,function(t,n){if(n.isOperation===!0&&t!=="del")return console.log(f(e+1)+n.type+": "+t)}),$.each(this,function(t,r){if(t!=="parent"&&t!=="root"&&r instanceof n)return r.show(e+1)}),null},n.prototype.toString=function(){return this.name},n.prototype.extractUrlData=function(e,t){var n,r,i,o,u,a,f,l,c,h,p,d,v,m;f=[],o=null;for(p=0,v=t.length;p<v;p++)n=t[p],$.type(n)==="string"?f.push(n):$.isPlainObject(n)&&o===null?o=n:s("Invalid parameter: "+n+" ("+$.type(n)+")."+" Must be strings (IDs) and one optional plain object (data).");c=f.length,r=e!=="create",i=e!=="update"&&e!=="delete",h=null,r&&c===this.numParents&&(h=this.url),i&&c===this.numParents-1&&(h=this.urlNoId),h===null&&(i&&(l=this.numParents-1),r&&(l=(l?l+" or ":"")+this.numParents),s("Invalid number of ID parameters, required "+l+", provided "+c));for(u=d=0,m=f.length;d<m;u=++d)a=f[u],h=h.replace(new RegExp("/:ID_"+(u+1)+"/"),"/"+a+"/");return{url:h,data:o}},n.prototype.ajax=function(e,t,n,r){var o,u,a,f,c=this;r==null&&(r={}),e||s("type missing"),t||s("url missing"),this.opts.username&&this.opts.password&&(u=i(this.opts.username+":"+this.opts.password),r.Authorization="Basic "+u),n&&this.opts.stringifyData&&(n=l(n)),o={url:t,type:e,headers:r,data:n,timeout:this.opts.timeout,crossDomain:this.opts.crossDomain,processData:this.opts.processData,dataType:this.opts.dataType};if(this.opts.cache){a=this.root.cache.key(o),f=this.root.cache.get(a);if(f)return f}return f=$.ajax(o),this.opts.cache&&f.complete(function(){return c.root.cache.put(a,f)}),f},n}(),$.RestClient=n}).call(this);